<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="Documentation about HPC Sumner"><link href=https://sumner.verhaaklab.com/conda/S01_conda/ rel=canonical><meta name=author content="Samir B. Amin"><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-\.]+><link rel="shortcut icon" href=/assets/images/favicon/apple-icon-180x180.png><meta name=generator content="mkdocs-1.1, mkdocs-material-4.4.0"><title>Set up conda environment</title><link rel=stylesheet href=../../assets/stylesheets/application.4031d38b.css><link rel=stylesheet href=../../assets/stylesheets/application-palette.224b79ff.css><meta name=theme-color content=#2196f3><script src=../../assets/javascripts/modernizr.74668098.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,400,400i,700|Fira+Code&display=fallback"><style>body,input{font-family:"IBM Plex Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Fira Code","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../assets/fonts/material-icons.css><link rel=stylesheet href=../../assets/css/katex.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-64053990-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-64053990-1');
</script><meta content=https://sumner.verhaaklab.com/conda/S01_conda/ property=og:url><meta property=og:title content="Set up conda environment"><meta property=og:description content="Documentation about HPC Sumner"><meta property=og:image content=https://sumner.verhaaklab.com/assets/images/favicon/apple-icon-180x180.png><meta property=og:image:alt content="Image alt"><meta property=og:image:type content=image/jpeg><meta property=og:image:width content=300><meta property=og:image:height content=300><meta name=twitter:card content=summary><meta name=twitter:site content=@jacksonlab><meta name=twitter:creator content=@jacksonlab><meta property=twitter:title content="Set up conda environment"><meta name=twitter:description content="Documentation about HPC Sumner"><meta name=twitter:image content=https://sumner.verhaaklab.com/assets/images/favicon/apple-icon-180x180.png><meta name=twitter:image:alt content="Image alt"></head> <body dir=ltr data-md-color-primary=blue data-md-color-accent=blue> <svg class=md-svg> <defs> <!-- <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> --> <svg xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink version=1.1 style=width:0;height:0;position:absolute;overflow:hidden;> <defs> <symbol viewbox="0 0 1024 998" aria-labelledby=dpsi-ant-github-title id=__github><title id=dpsi-ant-github-title>icon github</title><path fill=currentColor d="M0 512q0 166 95.5 298.5T343 996q6 1 10 1t6.5-1.5 4-3 2-5 .5-4.5V882q-37 4-66-.5t-45.5-14-29-23.5-17-25.5-9-24T194 780q-9-15-27-27.5t-27-20-2-14.5q50-26 113 66 34 51 119 30 10-41 40-70-116-21-172-86t-56-158q0-87 55-151-22-65 6-137 29-2 65 11.5t50.5 23T384 264q57-16 128.5-16T642 264q13-9 29-19t49-21.5 61-9.5q27 71 6 135 56 64 56 152 0 92-56.5 157.5T615 744q43 43 43 104v129q0 1 1 3 0 6 .5 9t4.5 6 11 3q154-52 251.5-185.5T1024 512q0-104-40.5-199t-109-163.5T711 40.5 512 0 313 40.5t-163.5 109T40.5 313 0 512z"/></symbol> </defs> </svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#first-time-login tabindex=1 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://sumner.verhaaklab.com title="Sumner Docs · JAX" class="md-header-nav__button md-logo"> <img src=/assets/images/sumner_logo_raw.png width=24 height=24> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Sumner Docs &middot; JAX </span> <span class=md-header-nav__topic> Set up conda environment </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/TheJacksonLaboratory/sumnerdocs/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> TheJacksonLaboratory/sumnerdocs </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <main class=md-main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://sumner.verhaaklab.com title="Sumner Docs · JAX" class="md-nav__button md-logo"> <img src=/assets/images/sumner_logo_raw.png width=48 height=48> </a> Sumner Docs &middot; JAX </label> <div class=md-nav__source> <a href=https://github.com/TheJacksonLaboratory/sumnerdocs/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> TheJacksonLaboratory/sumnerdocs </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=Home class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Set Up Conda </label> <a href=./ title="Set Up Conda" class="md-nav__link md-nav__link--active"> Set Up Conda </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#first-time-login title="First-time Login" class=md-nav__link> First-time Login </a> </li> <li class=md-nav__item> <a href=#backup-and-reset-dotfiles title="Backup and Reset Dotfiles" class=md-nav__link> Backup and Reset Dotfiles </a> </li> <li class=md-nav__item> <a href=#install-anaconda3 title="Install anaconda3" class=md-nav__link> Install anaconda3 </a> </li> <li class=md-nav__item> <a href=#configuring-conda title="Configuring Conda" class=md-nav__link> Configuring Conda </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#set-channel-priority title="Set channel priority" class=md-nav__link> Set channel priority </a> </li> <li class=md-nav__item> <a href=#install-r-361 title="Install R 3.6.1" class=md-nav__link> Install R 3.6.1 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pin-r-and-conda-auto-updates title="Pin R and conda auto-updates" class=md-nav__link> Pin R and conda auto-updates </a> </li> <li class=md-nav__item> <a href=#setup-rprofile-and-renviron title="Setup Rprofile and Renviron" class=md-nav__link> Setup Rprofile and Renviron </a> </li> <li class=md-nav__item> <a href=#installing-r-and-linux-packages title="Installing R and linux packages" class=md-nav__link> Installing R and linux packages </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#backup-conda-env title="Backup conda env" class=md-nav__link> Backup conda env </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Set Up Containers </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> Set Up Containers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../containers/S01_containers/ title="Getting Started" class=md-nav__link> Getting Started </a> </li> <li class=md-nav__item> <a href=../../containers/ensembl-vep/ title="How to run VEP using singularity" class=md-nav__link> How to run VEP using singularity </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> Working with Slurm </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> Working with Slurm </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../slurm/S01_slurm101/ title="Slurm 101" class=md-nav__link> Slurm 101 </a> </li> <li class=md-nav__item> <a href=../../slurm/how_to_interactive_via_tmux/ title="Interactive job inside tmux" class=md-nav__link> Interactive job inside tmux </a> </li> <li class=md-nav__item> <a href=../../slurm/how_to_snakemake_slurm/ title="How To Run Snakemake" class=md-nav__link> How To Run Snakemake </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=https://hpctalk.jax.org title="User Forum (intranet)" class=md-nav__link> User Forum (intranet) </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#first-time-login title="First-time Login" class=md-nav__link> First-time Login </a> </li> <li class=md-nav__item> <a href=#backup-and-reset-dotfiles title="Backup and Reset Dotfiles" class=md-nav__link> Backup and Reset Dotfiles </a> </li> <li class=md-nav__item> <a href=#install-anaconda3 title="Install anaconda3" class=md-nav__link> Install anaconda3 </a> </li> <li class=md-nav__item> <a href=#configuring-conda title="Configuring Conda" class=md-nav__link> Configuring Conda </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#set-channel-priority title="Set channel priority" class=md-nav__link> Set channel priority </a> </li> <li class=md-nav__item> <a href=#install-r-361 title="Install R 3.6.1" class=md-nav__link> Install R 3.6.1 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pin-r-and-conda-auto-updates title="Pin R and conda auto-updates" class=md-nav__link> Pin R and conda auto-updates </a> </li> <li class=md-nav__item> <a href=#setup-rprofile-and-renviron title="Setup Rprofile and Renviron" class=md-nav__link> Setup Rprofile and Renviron </a> </li> <li class=md-nav__item> <a href=#installing-r-and-linux-packages title="Installing R and linux packages" class=md-nav__link> Installing R and linux packages </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#backup-conda-env title="Backup conda env" class=md-nav__link> Backup conda env </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <!-- enable git edit link only if config.repo_edit is set to true --> <a href=https://github.com/TheJacksonLaboratory/sumnerdocs/edit/master/docs/conda/S01_conda.md title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a> <h1>Set Up Conda</h1> <div class="admonition danger"> <p class=admonition-title><img alt=☠️ class=emojione src=https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/2620.png title=:skull_and_crossbones:> <img alt=🚧 class=emojione src=https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f6a7.png title=:construction:> Work In Progress <img alt=🚧 class=emojione src=https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f6a7.png title=:construction:> <img alt=☠️ class=emojione src=https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/2620.png title=:skull_and_crossbones:></p> <p>Documentation is in alpha stage and not intended for setting up Sumner HPC environment.</p> </div> <h2 id=first-time-login>First-time Login<a class=headerlink href=#first-time-login title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code>ssh login.sumner.jax.org

<span class=c1>## Know OS and kernel version</span>
cat /etc/redhat-release
uname -a
</code></pre></div> <blockquote> <p>Running CentOS Linux release 7.7.1908 (Core)<br> Linux sumner-log2 3.10.0-1062.1.2.el7.x86_64 #1 SMP Mon Sep 30 14:19:46 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux </p> </blockquote> <ul> <li>First, login to sumner with a clean env, i.e., as it ships with default profile from HPC team, and nothing added in following files. Default bash configuration for sumner looks similar to <a href=/confs/dotfiles/hpc_default_env/ >/confs/dotfiles/hpc_default_env/</a>.</li> </ul> <div class=highlight><pre><span></span><code>~/.bashrc
~/.bash_profile
~/.bash_aliases <span class=c1># if it exists</span>
~/.profile <span class=c1># if it exists</span>
</code></pre></div> <ul> <li>If you had custom bash configs (linuxbrew, previous conda, etc.), comment those out from above files. If you'd linuxbrew installed, make sure to disable it unless you are confident that conda and linuxbrew can work in harmony!</li> </ul> <blockquote> <p>Same goes for <code>~/.local/</code> directory which should not exist at the fresh startup. If it does, you may have installed some tools using python, perl, or other non-root based setup scripts. For clean setup, <code>~/.local</code> directory needs to be removed from user environment, i.e., either rename it to say, ~/.local_deprecated or archive it somewhere!</p> </blockquote> <ul> <li>Make sure to logout and login to sumner again for a clean env to take an effect. Once you login, your <code>env</code> should look something similar to this one. Note that PATH variable will default to cent os 7 standard paths and LD_LIBRARY_PATH should preferably only contain entries related to slurm scheduler.</li> </ul> <div class=highlight><pre><span></span><code><span class=nb>exit</span> <span class=c1>#from sumner</span>

<span class=c1>## login again</span>
ssh login.sumner.jax.org
</code></pre></div> <ul> <li>Check common env variables set by default (HPC team)</li> </ul> <div class=highlight><pre><span></span><code><span class=c1>## paths where all executables can be found</span>
<span class=nb>echo</span> <span class=nv>$PATH</span>
</code></pre></div> <div class=highlight><pre><span></span><code>/cm/local/apps/gcc/8.2.0/bin:/cm/shared/apps/slurm/18.08.8/sbin:/cm/shared/apps/slurm/18.08.8/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:.:/home/yoda/.local/bin:/home/yoda/bin
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1>## paths where shared libraries are available to run programs</span>
<span class=nb>echo</span> <span class=nv>$LD_LIBRARY_PATH</span>
</code></pre></div> <div class=highlight><pre><span></span><code>/cm/local/apps/gcc/8.2.0/lib:/cm/local/apps/gcc/8.2.0/lib64:/cm/shared/apps/slurm/18.08.8/lib64/slurm:/cm/shared/apps/slurm/18.08.8/lib64
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1>## Used by gcc before compiling program</span>
<span class=c1>## Read https://stackoverflow.com/a/4250666/1243763 </span>
<span class=nb>echo</span> <span class=nv>$LIBRARY_PATH</span>
</code></pre></div> <div class=highlight><pre><span></span><code>/cm/shared/apps/slurm/18.08.8/lib64/slurm:/cm/shared/apps/slurm/18.08.8/lib64
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1>## default loaded modules</span>
<span class=c1>## Most of paths in PATH, LD_LIBRARY_PATH, and LIBRARY_PATH are configured by these loaded modules.</span>
module list
</code></pre></div> <blockquote> <p>Currently Loaded Modules: 1) shared 2) DefaultModules 3) dot 4) default-environment 5) slurm/18.08.8 6) gcc/8.2.0</p> </blockquote> <ul> <li>Store default hpc configuration</li> </ul> <blockquote> <p>Useful to fall back to HPC defaults if something goes awry!</p> </blockquote> <div class=highlight><pre><span></span><code>mkdir -p ~/bkup/confs/hpc_default_env/

cp .bashrc bkup/confs/hpc_default_env/
cp .bash_profile bkup/confs/hpc_default_env/

<span class=c1>## export global env</span>
env <span class=p>|</span> tee -a ~/bkup/confs/hpc_default_env/default_hpc_env.txt
</code></pre></div> <ul> <li><code>dot</code> module only appends <code>.</code> to PATH variable (see <code>module show dot</code>), so that you do not need to prefix <code>./</code> to run an executable file under present working directory. Since I do not need <code>dot</code> module, I will override default module loading by doing <code>module unload dot</code> in my bash configuration (later). </li> </ul> <div class=highlight><pre><span></span><code>module list
</code></pre></div> <ul> <li>For now, you may add following cmd to your <code>~/.bash_profile</code>. Eventually it will go to <code>~/.profile.d/</code> setup detailed below.</li> </ul> <div class=highlight><pre><span></span><code>module unload dot
</code></pre></div> <ul> <li>For now, I do not need system gcc and will rely on conda-installed gcc and other devtools <code>x86_64-conda_cos6-linux-gnu-*</code>. More on that later but let's unload gcc first.</li> </ul> <div class=highlight><pre><span></span><code>module unload gcc
module list
</code></pre></div> <div class=highlight><pre><span></span><code>Currently Loaded Modules:
  1) shared   2) DefaultModules   3) default-environment   4) slurm/18.08.8
</code></pre></div> <div class="admonition notice"> <p class=admonition-title>Unloading gcc</p> <p>Note that while starting pseudo-terminal using screen, tmux, or slurm interactive job, you may get module loaded gcc again in PATH. If so, <strong>make sure to do</strong> <code>module unload gcc</code> before running setup further.</p> </div> <h2 id=backup-and-reset-dotfiles>Backup and Reset Dotfiles<a class=headerlink href=#backup-and-reset-dotfiles title="Permanent link">&para;</a></h2> <ul> <li>Move dotfiles to archived directory</li> </ul> <blockquote> <p>If you have dotfiles and/or dot directories like .Renviron, .Rprofile, .curlrc, .cache, .config, etc., that may cause issues configuring environment.</p> </blockquote> <div class="admonition danger"> <p class=admonition-title><img alt=☠️ class=emojione src=https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/2620.png title=:skull_and_crossbones:> Moving dotfiles <img alt=☠️ class=emojione src=https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/2620.png title=:skull_and_crossbones:></p> <p>Following is what I've done but may not be safe unless you know what you are doing! Moving some of dotfiles is tricky as they are required for login to sumner. If you are doing this, <strong>make sure NOT to logout</strong> of sumner and at the end of executing this code block on sumner, make sure that you can login from another terminal to sumner.</p> </div> <div class=highlight><pre><span></span><code><span class=c1>## WARN: Moving all files and directories starting</span>
<span class=c1>## with dot to archived dir.</span>
mkdir -p <span class=s2>&quot;</span><span class=si>${</span><span class=nv>HOME</span><span class=si>}</span><span class=s2>&quot;</span>/legacy_env <span class=o>&amp;&amp;</span> <span class=se>\</span>
mv <span class=s2>&quot;</span><span class=si>${</span><span class=nv>HOME</span><span class=si>}</span><span class=s2>&quot;</span>/.<span class=o>[</span>^.<span class=o>]</span>* legacy_env/

<span class=c1>## DO NOT FORGET TO COPY BACK following files to</span>
<span class=c1>## &quot;${HOME}&quot;/ else you may get locked out of sumner.</span>

<span class=nb>cd</span> <span class=s2>&quot;</span><span class=si>${</span><span class=nv>HOME</span><span class=si>}</span><span class=s2>&quot;</span> <span class=o>&amp;&amp;</span> <span class=se>\</span>
<span class=nb>echo</span> <span class=s2>&quot;You are in home directory at </span><span class=k>$(</span><span class=nb>pwd</span><span class=k>)</span><span class=s2>&quot;</span>

<span class=c1>## sumner ssh dir</span>
rsync -avhP legacy_env/.ssh ./

<span class=c1>## sumner login tokens, if any</span>
cp legacy_env/.vas_* ./
cp legacy_env/.bash* ./
cp legacy_env/.ksh* ./
cp legacy_env/.k5login ./
rsync -avhP legacy_env/.pki ./
rsync -avhP legacy_env/.parallel ./

<span class=c1>## optional files, if any</span>
<span class=c1>## singularity may take a larger space </span>
rsync -avhP legacy_env/.singularity ./

rsync -avhP legacy_env/.subversion ./
cp legacy_env/.emacs ./
cp legacy_env/.viminfo ./

<span class=c1>## make empty dirs</span>
<span class=c1>## note that user .local and .config, if any are now backed up and</span>
<span class=c1>## we are creating a empty ~/.local directory</span>
mkdir -p <span class=s2>&quot;</span><span class=si>${</span><span class=nv>HOME</span><span class=si>}</span><span class=s2>&quot;</span>/.cache
mkdir -p <span class=s2>&quot;</span><span class=si>${</span><span class=nv>HOME</span><span class=si>}</span><span class=s2>&quot;</span>/.config
mkdir -p <span class=s2>&quot;</span><span class=si>${</span><span class=nv>HOME</span><span class=si>}</span><span class=s2>&quot;</span>/.local

<span class=c1>## CONFIRM FROM A SEPARATE TERMINAL that you can login to sumner</span>
ssh yoda@sumner
env
</code></pre></div> <ul> <li>If above command succeeds and env looks similar (PATH in particular) to PATH and LD_LIBRARY_PATH shown above, you're good! You can exit old sumner session and install anaconda3 in new terminal session.</li> </ul> <div class="admonition info"> <p class=admonition-title>Start Interactive Job prior to installation</p> <p>Prefer running setup on a dedicated interactive node instead of login node. Some of conda install/update steps may get killed on login node.</p> <div class=highlight><pre><span></span><code>srun -p compute -q batch -N <span class=m>1</span> -n <span class=m>3</span> --mem 10G -t <span class=m>08</span>:00:00 --pty bash
</code></pre></div> </div> <h2 id=install-anaconda3>Install anaconda3<a class=headerlink href=#install-anaconda3 title="Permanent link">&para;</a></h2> <div class="admonition warning"> <p class=admonition-title>Python3 over Python2</p> <p>Prefer using Anaconda3 (Python3) over Python2 as the latter has reached <a href=https://www.python.org/doc/sunset-python-2/ >End of Life</a>.</p> </div> <blockquote> <p>For anaconda3: Using <em>v2019.03-Linux-x86_64</em> with <a href=https://repo.anaconda.com/archive/Anaconda2-2019.03-Linux-x86_64.sh>permalink</a> and <a href=https://docs.anaconda.com/anaconda/install/hashes/Anaconda3-2019.03-Linux-x86_64.sh-hash/ >MD5</a>: b77a71c3712b45c8f33c7b2ecade366c.</p> </blockquote> <div class=highlight><pre><span></span><code><span class=nb>cd</span> <span class=s2>&quot;</span><span class=nv>$HOME</span><span class=s2>&quot;</span> <span class=o>&amp;&amp;</span> <span class=se>\</span>
mkdir -p Downloads/conda <span class=o>&amp;&amp;</span> <span class=se>\</span>
<span class=nb>cd</span> Downloads/conda <span class=o>&amp;&amp;</span> <span class=se>\</span>
wget https://repo.anaconda.com/archive/Anaconda3-2019.10-Linux-x86_64.sh <span class=o>&amp;&amp;</span> <span class=se>\</span>
md5sum Anaconda3-2019.10-Linux-x86_64.sh
</code></pre></div> <ul> <li>Setup anaconda3 environment with default options, i.e., install at <code>~/anaconda3</code>.</li> </ul> <div class=highlight><pre><span></span><code><span class=nb>cd</span> <span class=s2>&quot;</span><span class=nv>$HOME</span><span class=s2>&quot;</span> <span class=o>&amp;&amp;</span> <span class=se>\</span>
bash ~/Downloads/conda/Anaconda3-2019.10-Linux-x86_64.sh
</code></pre></div> <ul> <li>Once conda installation is complete at default location, logout and login to sumner. Default conda env, <code>base</code> will now be in effect. Note <code>(base)</code> prefix to your username. Also, check output of following:</li> </ul> <div class=highlight><pre><span></span><code><span class=nb>echo</span> <span class=nv>$CONDA_DEFAULT_ENV</span>
</code></pre></div> <blockquote> <p>base</p> </blockquote> <div class=highlight><pre><span></span><code><span class=nb>echo</span> <span class=nv>$CONDA_PREFIX</span>
</code></pre></div> <blockquote> <p>/home/yoda/anaconda3</p> </blockquote> <h2 id=configuring-conda>Configuring Conda<a class=headerlink href=#configuring-conda title="Permanent link">&para;</a></h2> <p>Following are additional configuration within conda environment to enable installation of R 3.6.1+ and Jupyter.</p> <h3 id=set-channel-priority>Set channel priority<a class=headerlink href=#set-channel-priority title="Permanent link">&para;</a></h3> <div class="admonition important"> <p class=admonition-title>Important</p> <p>Prefer installing compilers only from a single channel and avoid mix-and-match install. Read more at <a href=https://conda-forge.org/docs/user/tipsandtricks.html>conda-forge page</a> on <code>channel_priority: strict</code> which is enabled at default for conda v4.6 or higher.</p> </div> <ul> <li>Add Bioconda and conda-forge channels to get updated and compbio related packages. Avoid changing order of following commands unless you prefer to keep a different priority for these channels.</li> </ul> <div class=highlight><pre><span></span><code>conda config --add channels defaults
conda config --add channels bioconda
conda config --add channels conda-forge
</code></pre></div> <ul> <li>Above command will generate <code>~/.condarc</code> file and set priority for channels, i.e., when same package is available from more than one channels, we prioritize installation per ordered channel list in <code>~/.condarc</code> file as shown below. This file should be present after above commands and no need to edit unless changing priority of channels.</li> </ul> <blockquote> <p>This is in yaml format file. Please take care of preceding spaces (and not tabs) before and after <code>-</code> while editing this file.</p> </blockquote> <div class=highlight><pre><span></span><code>channels:
  - conda-forge
  - bioconda
  - defaults
</code></pre></div> <h3 id=install-r-361>Install R 3.6.1<a class=headerlink href=#install-r-361 title="Permanent link">&para;</a></h3> <ul> <li> <p>For compatibility with conda env, prefer installing R 3.6 via conda.</p> </li> <li> <p>Prefer installing R env from <code>conda-forge</code> channel which is already a priority channel in our <code>~/.condarc</code>. We also specify R version, just to make sure that we install R v3.6.1.</p> </li> </ul> <div class="admonition bug"> <p class=admonition-title>Beware of non-standard conda packages</p> <p>Note that most up-to-date R version may be available in the same or other conda channels, like <code>r</code> or <code>bioconda</code> but it is preferable to install R from the first priority channel, i.e., <code>conda-forge</code> in our case, and where package does not show non-standard labels at anaconda website, e.g., As of writing this section, R 3.6.2 on <a href=https://anaconda.org/conda-forge/r-base>anaconda website</a> shows use of non-standard labels, most likely because it was updated a few days before and so, may not comply with all of conda dependency.</p> </div> <div class=highlight><pre><span></span><code><span class=c1>## look for a line r-base and check source channel.</span>
<span class=c1>## If it is other than conda-forge, try to downgrade R package where</span>
<span class=c1>## r-base is available under conda-forge channel.</span>
conda install -c conda-forge r-base<span class=o>=</span><span class=m>3</span>.6.1
</code></pre></div> <ul> <li>Above command will take 15-30 min to resolve dependencies. It will do <strong>major overhaul</strong> of default conda environment by...<ul> <li>upgrading conda to latest version, 4.8.2 or higher.</li> <li>installing conda and r-base from conda-forge source.</li> <li>and much more...</li> </ul> </li> </ul> <h4 id=pin-r-and-conda-auto-updates>Pin R and conda auto-updates<a class=headerlink href=#pin-r-and-conda-auto-updates title="Permanent link">&para;</a></h4> <ul> <li>Before moving further, let's <a href=https://stackoverflow.com/a/48733093/1243763 title="how to fix software versions in conda environment - stackoverflow">pin R version</a> to 3.6.1 and also disallow conda auto-updates. That way, we have lesser chances of breaking conda env when we do <code>conda install &lt;pkg&gt;</code> in future, and carefully install/update packages without breaking existing setup.</li> </ul> <div class="admonition tip"> <p class=admonition-title>Compile over <code>conda install Rpkg</code></p> <p>Typically, I avoid installing or updating package if <code>conda install</code> throws a message or warning about <strong>removing or downgrading</strong> existing packages. In such cases, I fall back to compiling package using available devtools in conda and sumner. Also, I load compiled package using <em>Modulefile</em> when needed, and not integrate it in my default bash environment as this may give errors while running some random program due to conflicts in shared library versions.</p> </div> <div class=highlight><pre><span></span><code>conda config --set auto_update_conda False

<span class=c1>## add following to pinned file</span>
nano ~/anaconda3/conda-meta/pinned
</code></pre></div> <blockquote> <p>r-base ==3.6.1</p> </blockquote> <h4 id=setup-rprofile-and-renviron>Setup Rprofile and Renviron<a class=headerlink href=#setup-rprofile-and-renviron title="Permanent link">&para;</a></h4> <ul> <li>Setup R package directory path for R 3.6</li> </ul> <div class=highlight><pre><span></span><code>mkdir -p ~/R/pkgs/v3.6
</code></pre></div> <ul> <li> <p>Create these two files to setup startup env for R</p> </li> <li> <p>Renviron</p> </li> </ul> <div class=highlight><pre><span></span><code>nano ~/.Renviron
</code></pre></div> <div class="admonition tip"> <p class=admonition-title>Where should R save new packages?</p> <p>Over time, this directory may grow in size, so better to keep under tier1 storage.</p> </div> <div class=highlight><pre><span></span><code><span class=nv>R_LIBS</span><span class=o>=</span><span class=s2>&quot;/projects/verhaak-lab/yoda/sumnerenv_os7/R/pkgs/v3.6:/home/yoda/R/pkgs/v3.6:/home/yoda/anaconda3/lib/R/library&quot;</span>
</code></pre></div> <blockquote> <p>You can confirm precedence of R library paths in R using <code>.libPaths()</code> command. Note that <em>/home/yoda/anaconda3/lib/R/library</em> is a required path set while installing R using conda.</p> </blockquote> <ul> <li>R profile</li> </ul> <div class=highlight><pre><span></span><code>nano ~/.Rprofile
</code></pre></div> <div class=highlight><pre><span></span><code>## set user specific env variables, if any here
## e.g., GITHUB_PAT if here
Sys.setenv(&quot;GITHUB_PAT&quot;=&quot;xyzabc1234&quot;)

## Default source to download packages
local({
  r &lt;- getOption(&quot;repos&quot;)
  r[&quot;CRAN&quot;] &lt;- &quot;https://cran.rstudio.com&quot;
  options(repos = r)
})
</code></pre></div> <ul> <li>Before further configuring sumner env, let's logout and login first from interactive job and exit sumner. Then, login back to sumner and start interactive queue again.</li> </ul> <div class=highlight><pre><span></span><code><span class=nb>exit</span> <span class=c1># from interactive session</span>
<span class=nb>exit</span> <span class=c1># from sumner</span>

ssh sumner

<span class=c1>## start interactive session</span>
srun -p compute -q batch -N <span class=m>1</span> -n <span class=m>3</span> --mem 10G -t <span class=m>08</span>:00:00 --pty bash
</code></pre></div> <ul> <li>Confirm that login env is similar to earlier env (just after anaconda3 setup) by running <code>env</code> command. PATH should now have paths related to conda env <strong>prefixed</strong> but nothing else related to modules, LD_LIBRARY_PATH, etc.</li> </ul> <p>Also, make sure that module: gcc is unloaded. We do not want system gcc (or any other devtools), and instead rely on conda-installed devtools.</p> <div class=highlight><pre><span></span><code><span class=c1>## unload gcc if loaded</span>
module unload gcc

<span class=c1>## example PATH variable</span>
/home/yoda/anaconda3/bin:/home/yoda/anaconda3/condabin:/cm/shared/apps/slurm/18.08.8/sbin:/cm/shared/apps/slurm/18.08.8/bin
:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/home/yoda/.local/bin:/home/yoda/bin
</code></pre></div> <div class="admonition tip"> <p class=admonition-title>Avoid Rpkgs using <code>conda install</code></p> <p>Install essential R packages and jupyter kernel for R <strong>only if</strong> they are available for R 3.6.x (preferably v3.6.1) from conda-forge channel. This may not be a case for most times, e.g., for R v3.5.1, I can find compatible packages but not for R 3.6. I avoid downloading <code>r-essentials</code> from other channels, including <code>r</code> as some packages have dependencies on shared library which are different between <code>r</code> and <code>conda-forge</code> channel. I prefer installing R packages using <code>install.packages</code>, <code>devtools::install_github()</code> or <code>BiocManager</code> command in R.</p> </div> <div class=highlight><pre><span></span><code><span class=c1>## This did not work for R 3.6.1</span>
<span class=c1># conda install -c conda-forge r-essentials</span>
</code></pre></div> <h4 id=installing-r-and-linux-packages>Installing R and linux packages<a class=headerlink href=#installing-r-and-linux-packages title="Permanent link">&para;</a></h4> <p>Here, I alternate between R and bash to install packages I use on regular basis. It is going to take a while to install these packages. You may not need to install all packages but if you are skipping ahead and get into error because of missing library, package, etc., you probably need to revisit this code block and confirm that you have all of dependencies in your environment for successful installation.</p> <div class=highlight><pre><span></span><code><span class=nf>install.packages</span><span class=p>(</span><span class=s>&quot;devtools&quot;</span><span class=p>)</span>
</code></pre></div> <blockquote> <p>When you start installing R packages, notice <code>x86_64-conda_cos6-linux-gnu-cc</code> or other compilers that R is using instead of <code>/usr/bin/gcc</code> or sumner-defaults. Similarly, during loading R packages which requires shared libraries, we link shared libs from conda and not from system-defaults (gcc and others). That's one of reasons I did <code>module unload gcc</code> before installing R packages. Eventually, we will set <strong>~/.profile.d</strong> environment such that it will always load conda environment and ignore gcc and other devtools from system paths. </p> </blockquote> <div class="admonition danger"> <p class=admonition-title><img alt=☠️ class=emojione src=https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/2620.png title=:skull_and_crossbones:> <img alt=🚧 class=emojione src=https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f6a7.png title=:construction:> Work In Progress <img alt=🚧 class=emojione src=https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f6a7.png title=:construction:> <img alt=☠️ class=emojione src=https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/2620.png title=:skull_and_crossbones:></p> <p>Documentation is in alpha stage and not intended for setting up Sumner HPC environment.</p> </div> <hr> <h3 id=backup-conda-env>Backup conda env<a class=headerlink href=#backup-conda-env title="Permanent link">&para;</a></h3> <ul> <li>Base environment.</li> </ul> <div class=highlight><pre><span></span><code><span class=c1>## script is on github repo under conds/bin/</span>
./conda_bkup.sh
</code></pre></div> <p>Last updated: February 27, 2020</p> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../.. title=Home class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Previous </span> Home </span> </div> </a> <a href=../../containers/S01_containers/ title="Getting Started" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Next </span> Getting Started </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; <a href=https://www.jax.org>The Jackson Laboratory</a> | <a href=https://www.jax.org/terms-of-use>Terms of Use</a> </div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> | <a href=https://github.com/sbamin/theme-mkdocs-material/ > Forked Code</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../assets/fonts/font-awesome.css> <a href=https://hpctalk.jax.org class="md-footer-social__link fa fa-envelope"></a> <a href=https://twitter.com/jacksonlab class="md-footer-social__link fa fa-twitter"></a> <a href=https://github.com/TheJacksonLaboratory/sumnerdocs class="md-footer-social__link fa fa-github"></a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/application.ffb616e8.js></script> <script>app.initialize({version:"1.1",url:{base:"../.."}})</script> <script src=../../assets/js/katex.js></script> <script src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js></script> <script src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js></script> <script src=../../search/main.js></script> </body> </html>