<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="Documentation about HPC Sumner"><link href=https://sumner.verhaaklab.com/slurm/how_to_interactive_via_tmux/ rel=canonical><meta name=author content="Samir B. Amin"><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-\.]+><link rel="shortcut icon" href=/assets/images/favicon/apple-icon-180x180.png><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.4.0"><title>Interactive job inside tmux</title><link rel=stylesheet href=../../assets/stylesheets/application.4031d38b.css><link rel=stylesheet href=../../assets/stylesheets/application-palette.224b79ff.css><meta name=theme-color content=#2196f3><script src=../../assets/javascripts/modernizr.74668098.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,400,400i,700|Fira+Code&display=fallback"><style>body,input{font-family:"IBM Plex Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Fira Code","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../assets/fonts/material-icons.css><link rel=stylesheet href=../../assets/css/katex.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css><meta content=https://sumner.verhaaklab.com/slurm/how_to_interactive_via_tmux/ property=og:url><meta property=og:title content="Interactive job inside tmux"><meta property=og:description content="Documentation about HPC Sumner"><meta property=og:image content=https://sumner.verhaaklab.com/assets/images/favicon/apple-icon-180x180.png><meta property=og:image:alt content="Image alt"><meta property=og:image:type content=image/jpeg><meta property=og:image:width content=300><meta property=og:image:height content=300><meta name=twitter:card content=summary><meta name=twitter:site content=@jacksonlab><meta name=twitter:creator content=@jacksonlab><meta property=twitter:title content="Interactive job inside tmux"><meta name=twitter:description content="Documentation about HPC Sumner"><meta name=twitter:image content=https://sumner.verhaaklab.com/assets/images/favicon/apple-icon-180x180.png><meta name=twitter:image:alt content="Image alt"></head> <body dir=ltr data-md-color-primary=blue data-md-color-accent=blue> <svg class=md-svg> <defs> <!-- <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> --> <svg xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink version=1.1 style=width:0;height:0;position:absolute;overflow:hidden;> <defs> <symbol viewbox="0 0 1024 998" aria-labelledby=dpsi-ant-github-title id=__github><title id=dpsi-ant-github-title>icon github</title><path fill=currentColor d="M0 512q0 166 95.5 298.5T343 996q6 1 10 1t6.5-1.5 4-3 2-5 .5-4.5V882q-37 4-66-.5t-45.5-14-29-23.5-17-25.5-9-24T194 780q-9-15-27-27.5t-27-20-2-14.5q50-26 113 66 34 51 119 30 10-41 40-70-116-21-172-86t-56-158q0-87 55-151-22-65 6-137 29-2 65 11.5t50.5 23T384 264q57-16 128.5-16T642 264q13-9 29-19t49-21.5 61-9.5q27 71 6 135 56 64 56 152 0 92-56.5 157.5T615 744q43 43 43 104v129q0 1 1 3 0 6 .5 9t4.5 6 11 3q154-52 251.5-185.5T1024 512q0-104-40.5-199t-109-163.5T711 40.5 512 0 313 40.5t-163.5 109T40.5 313 0 512z"/></symbol> </defs> </svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://sumner.verhaaklab.com title="Sumner Docs · JAX" class="md-header-nav__button md-logo"> <img src=/assets/images/sumner_logo_raw.png width=24 height=24> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Sumner Docs &middot; JAX </span> <span class=md-header-nav__topic> Interactive job inside tmux </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/TheJacksonLaboratory/sumnerdocs/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> TheJacksonLaboratory/sumnerdocs </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <main class=md-main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://sumner.verhaaklab.com title="Sumner Docs · JAX" class="md-nav__button md-logo"> <img src=/assets/images/sumner_logo_raw.png width=48 height=48> </a> Sumner Docs &middot; JAX </label> <div class=md-nav__source> <a href=https://github.com/TheJacksonLaboratory/sumnerdocs/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> TheJacksonLaboratory/sumnerdocs </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=Home class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../../conda/S01_conda/ title="Set Up Conda" class=md-nav__link> Set Up Conda </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Set Up Containers </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> Set Up Containers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../containers/S01_containers/ title="Getting Started" class=md-nav__link> Getting Started </a> </li> <li class=md-nav__item> <a href=../../containers/ensembl-vep/ title="How to run VEP using singularity" class=md-nav__link> How to run VEP using singularity </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4 checked> <label class=md-nav__link for=nav-4> Working with Slurm </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> Working with Slurm </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../S01_slurm101/ title="Slurm 101" class=md-nav__link> Slurm 101 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <a href=./ title="Interactive job inside tmux" class="md-nav__link md-nav__link--active"> Interactive job inside tmux </a> </li> <li class=md-nav__item> <a href=../how_to_snakemake_slurm/ title="How To Run Snakemake" class=md-nav__link> How To Run Snakemake </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=https://hpctalk.jax.org title="User Forum (intranet)" class=md-nav__link> User Forum (intranet) </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <!-- enable git edit link only if config.repo_edit is set to true --> <a href=https://github.com/TheJacksonLaboratory/sumnerdocs/edit/master/docs/slurm/how_to_interactive_via_tmux.md title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a> <h1>Interactive job inside tmux</h1> <p>Each time you login to Sumner HPC, you will be redirected to one of two login nodes. If you are using <mark>tmux and running interactive job</mark> (using slurm) on a compute node, you may prefer to detach it, say during lunch or meeting times and like to re-attach afterwards from your local machine. If so, you do need to remember on which of two login nodes your tmux session was running, and login to that node and re-attach tmux session.</p> <p>This bash wrapper around tmux and slurm scheduler will (for the most part) do that job.</p> <ul> <li>Using <code>tmux -V</code>. I've tested it with v2.9+</li> <li>Copy <em>start_interactive</em> from <a href=https://github.com/TheJacksonLaboratory/sumnerdocs/blob/master/docs/confs/bin>docs/confs/bin</a> directory to <em>~/bin/start_interactive</em> and <code>chmod 755 start_interactive</code>.<ul> <li>If needed, change default resources and walltime for interactive job command where variable <code>INTJOB</code> is specified.</li> <li>This script will change move <code>TMUX_TMPDIR</code> from <em>/tmp</em> to <em>~/logs/tmux</em> and bind tmux session with session ID specific to login-node, e.g., S1 and S2 for respectively, login-node1 and login-node2.</li> </ul> </li> <li>From your local machine, place a bash wrapper like <em>~/bin/run_interactive_hpc</em> with following code, and do <code>chmod 755 ~/bin/run_interactive_hpc</code><ul> <li>You may need to add/edit sumner profile in local <em>~/.ssh/config</em>.</li> </ul> </li> </ul> <details class=tip><summary>Local <em>~/.ssh/config</em> file</summary><table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class=code><div class=codehilite><pre><span></span>## example config for sumner.
Host sumner
    Hostname login.sumner.jax.org
    User foo
    IdentityFile ~/.ssh/id_rsa
    IdentitiesOnly yes
    Port 22
    ServerAliveInterval 40
    ServerAliveCountMax 10
    StrictHostKeyChecking no

Host sumner1
    Hostname sumner-log1.sumner.jax.org
    User foo
    IdentityFile ~/.ssh/id_rsa
    IdentitiesOnly yes
    Port 22
    ServerAliveInterval 40
    ServerAliveCountMax 10
    StrictHostKeyChecking no

Host sumner2
    Hostname sumner-log2.sumner.jax.org
    User foo
    IdentityFile ~/.ssh/id_rsa
    IdentitiesOnly yes
    Port 22
    ServerAliveInterval 40
    ServerAliveCountMax 10
    StrictHostKeyChecking no
</pre></div> </td></tr></table> </details> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=ch>#!/bin/bash</span>

<span class=c1>## Run or attach to interactive session on one of sumner login nodes</span>

ssh sumner -t <span class=s1>&#39;bash -l -c &quot;start_interactive&quot;&#39;</span>
<span class=nv>exitstat1</span><span class=o>=</span><span class=nv>$?</span>

<span class=k>if</span> <span class=o>[[</span> <span class=s2>&quot;</span><span class=nv>$exitstat1</span><span class=s2>&quot;</span> !<span class=o>=</span> <span class=m>0</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
    <span class=nb>echo</span> -e <span class=s2>&quot;\n#####\nAttempt one more time to match login node and tmux session\n#####\n&quot;</span>
    sleep <span class=m>5</span>
    <span class=c1>## extract stderr for parsing remote hostname</span>
    ssh sumner -t <span class=s1>&#39;bash -l -c &quot;start_interactive&quot;&#39;</span> &gt;<span class=p>|</span> /tmp/sumner_interactive
    <span class=nv>exitstat2</span><span class=o>=</span><span class=nv>$?</span>

    <span class=k>if</span> <span class=o>[[</span> <span class=s2>&quot;</span><span class=nv>$exitstat2</span><span class=s2>&quot;</span> !<span class=o>=</span> <span class=m>0</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>echo</span> -e <span class=s2>&quot;\nForce ssh to login node matching tmux session.&quot;</span>

        <span class=c1>## get login node where tmux is running</span>
        <span class=nv>TMUXHOST</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>grep -Eo <span class=s2>&quot;S[12]{1}INT&quot;</span> /tmp/sumner_interactive<span class=k>)</span><span class=s2>&quot;</span>
        <span class=nb>echo</span> -e <span class=s2>&quot;\ntmux session ID is </span><span class=si>${</span><span class=nv>TMUXHOST</span><span class=si>}</span><span class=s2>\nForce login to server where tmux is running.&quot;</span>

        <span class=c1>## Using ~/.ssh/config profile for a specific login node</span>
        <span class=k>if</span> <span class=o>[[</span> <span class=s2>&quot;</span><span class=si>${</span><span class=nv>TMUXHOST</span><span class=si>}</span><span class=s2>&quot;</span> <span class=o>==</span> <span class=s2>&quot;S1INT&quot;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
            ssh sumner1 -t <span class=s1>&#39;bash -l -c &quot;start_interactive&quot;&#39;</span>
        <span class=k>elif</span> <span class=o>[[</span> <span class=s2>&quot;</span><span class=si>${</span><span class=nv>TMUXHOST</span><span class=si>}</span><span class=s2>&quot;</span> <span class=o>==</span> <span class=s2>&quot;S2INT&quot;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
            ssh sumner2 -t <span class=s1>&#39;bash -l -c &quot;start_interactive&quot;&#39;</span>
        <span class=k>else</span>
            <span class=nb>echo</span> -e <span class=s2>&quot;\nERROR: Invalid pattern for remote tmux session ID: </span><span class=si>${</span><span class=nv>TMUXHOST</span><span class=si>}</span><span class=s2>\nIt should be either S1INT or S2INT.\nCan not start_interactive session.&quot;</span> &gt;<span class=p>&amp;</span><span class=m>2</span>
            <span class=nb>exit</span> <span class=m>1</span>
        <span class=k>fi</span>
    <span class=k>fi</span>
<span class=k>fi</span>

<span class=c1>## END ##</span>
</pre></div> </td></tr></table> <ul> <li>From your local machine, run <code>~/bin/run_interactive_hpc</code> and see if it works! If not, feel free to raise question at <a href=https://hpctalk.jax.org>user forum</a>.</li> </ul> <div class="admonition info"> <p class=admonition-title>Notes</p> <ul> <li>Avoid running <code>start_interactive</code> while you are on login node or spawning new interactive job inside a custom tmux session. Instead, prefer running <code>~/bin/run_interactive_hpc</code> <strong>from your local machine</strong>.</li> <li>Wrapper allows running only one interactive job with login-node specific job name, and relies on login-node specific tmux session else it will fail to work.</li> <li>If you like to go back to detached tmux session from login node, you can instead use <code>tmux new-session -A -s S1</code> (or S2 for login-node2) to attach to either running session or create a new one. <a href=https://unix.stackexchange.com/a/176885/28675>Details here</a> or checkout <a href=https://github.com/TheJacksonLaboratory/sumnerdocs/blob/master/docs/confs/bin/tmx>docs/confs/bin/tmx</a>.</li> </ul> </div> <p>Last updated: March 30, 2020</p> <h2 id=__source>Source</h2> <a href=https://github.com/TheJacksonLaboratory/sumnerdocs/blob/master/docs/confs/bin/start_interactive title=start_interactive class=md-source-file> start_interactive </a> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../S01_slurm101/ title="Slurm 101" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Previous </span> Slurm 101 </span> </div> </a> <a href=../how_to_snakemake_slurm/ title="How To Run Snakemake" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Next </span> How To Run Snakemake </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; <a href=https://www.jax.org>The Jackson Laboratory</a> | <a href=https://www.jax.org/terms-of-use>Terms of Use</a> </div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> | <a href=https://github.com/sbamin/theme-mkdocs-material/ > Forked Code</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../assets/fonts/font-awesome.css> <a href=https://hpctalk.jax.org class="md-footer-social__link fa fa-envelope"></a> <a href=https://twitter.com/jacksonlab class="md-footer-social__link fa fa-twitter"></a> <a href=https://github.com/TheJacksonLaboratory/sumnerdocs class="md-footer-social__link fa fa-github"></a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/application.ffb616e8.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script> <script src=../../assets/js/katex.js></script> <script src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js></script> <script src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js></script> <script src=../../search/main.js></script> </body> </html>